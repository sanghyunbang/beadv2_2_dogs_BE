#!/bin/sh
#
# Pre-commit hook for Baro Farm project
# 커밋 전 코드 품질 검사 실행
#

echo "🔍 Pre-commit hook 실행 중..."

# 프로젝트 루트 디렉토리로 이동
cd "$(git rev-parse --show-toplevel)" || exit 1

# Gradle 데몬 중지 (lock 파일 문제 방지)
./gradlew --stop > /dev/null 2>&1

# 코드 품질 검사 (Spotless + Checkstyle)
echo ""
echo "📝 코드 품질 검사 중..."
./gradlew lint --no-daemon -q

if [ $? -ne 0 ]; then
    echo ""
    echo "❌ 코드 품질 검사 실패!"
    echo "👉 포맷 자동 수정: ./gradlew format"
    echo "👉 상세 내용 확인: build/reports/checkstyle/"
    echo ""
    exit 1
fi

echo "✅ 코드 품질 검사 통과"
echo ""
echo "🎉 모든 검사 통과! 커밋을 진행합니다."
exit 0
